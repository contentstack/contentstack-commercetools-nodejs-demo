{ "blt8faaea1abddb88eb": { "stackHeaders": { "api_key": "bltc91ab68f0b5e7b84" }, "urlPath": "/extensions/blt8faaea1abddb88eb", "created_at": "2021-09-01T06:00:17.415Z", "updated_at": "2021-09-09T07:03:24.571Z", "tags": [], "ACL": [], "_version": 58, "title": "CommerceTools", "config": { "api_url": "api.us-central1.gcp.commercetools.com", "auth_url": "auth.us-central1.gcp.commercetools.com", "type": "product_multiple", "page_count": "20", "project_key": "add project key here", "client_id": "add client id here", "client_secret": "add secret key here", "locale": "add locale here", "redirect_url": "add asset url here" }, "type": "field", "data_type": "json", "multiple": false, "srcdoc": "<!doctype html>\n<html lang=\"en\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Commercetools Extension</title>\n\n  <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css\">\n  <script src=\"https://code.jquery.com/jquery-3.5.1.min.js\"></script>\n  <script src=\"https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js\"></script>\n  <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js\"></script>\n  <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css\">\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.0/axios.min.js\"></script>\n  <script src=\"https://unpkg.com/@contentstack/ui-extensions-sdk@2.2.0/dist/ui-extension-sdk.js\"></script>\n  <link href=\"https://unpkg.com/@contentstack/ui-extensions-sdk@2.2.0/dist/ui-extension-sdk.css\" rel=\"stylesheet\">\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/7.12.1/polyfill.min.js\"></script>\n  <script src=\"https://unpkg.com/currency.js/dist/currency.min.js\"></script>\n  <style>.dropdown-toggle::after,.main{display:none}#loader{display:block}dl,ol,ul{margin-bottom:0}.selected-search{margin-left:6px;margin-top:6px}.error-text-product::before,.error-text::before{content:'';background:url(https://new-static.contentstack.io/images/error-icon.svg);background-size:cover;position:absolute;width:20px;height:20px;margin-left:-20px;margin-top:-5px}.error-text-product{color:red;-webkit-line-clamp:3!important;white-space:normal!important;text-align:center;font-size:12px!important;border:.1px solid gray;border-radius:3px;padding:20px;max-width:300px;margin:50px auto;background:#fff}.error-bg{background:#f0f8ff}.error-text{color:red;-webkit-line-clamp:3!important;white-space:normal!important;text-align:center}.li-search{width:100%;cursor:pointer;padding:6px 10px;margin:0;font-size:13px}.categories-field .selected-category li{padding-right:20px;line-height:normal}.dropdown-menu ul li:hover{background-color:#f5f5f5}.cs-table-body li div{list-style-position:inside;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;height:71px}#message-container{color:#f77d7a;display:none}.action span img{height:11px;width:11px}.cs-table-body .table-row .table-cell img{margin-top:-17px}.cs-table .cs-table-body .table-cell{color:#748590;padding:25px 15px;max-height:71px}.cs-table .cs-table-head{height:58px}.cs-table .cs-table-head .table-cell{padding:22px 10px 19px 15px}.action .remove:hover{cursor:pointer}.img-container{width:30%;height:200px;justify-content:center;display:flex;flex-direction:row;overflow:hidden;max-width:30%}.img-container .img-to-fit{width:100%;height:100%;object-fit:contain}.card-title,.text-muted{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:5;-webkit-box-orient:vertical}.card-title{-webkit-line-clamp:2;font-size:17px;font-weight:700;margin-bottom:12px}.card-subtitle{font-size:15px;margin-bottom:5px}.col-sm-6{padding-right:.5rem;padding-left:.5rem}.categories-field{margin-bottom:10px}.row{margin-right:0;margin-left:0;margin-top:4px}.card:hover{box-shadow:0 0 11px rgba(33,33,33,.2)}.action{display:none;margin-top:-15px;margin-right:-10px;float:right}.card:hover .action{display:inline}.selected-item{max-height:400px;overflow:scroll;overflow-x:hidden}.selected-item::-webkit-scrollbar{width:5px;background-color:transparent}.selected-item::-webkit-scrollbar-thumb{border-radius:6px;background-color:#dfe2e9;cursor:pointer}.selected-item::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.categories-field .selected-category{max-height:382px;overflow-y:auto;margin-left:-19px;padding-left:19px;overflow-x:hidden}.categories-field .selected-category .category.selected{height:60px;overflow:hidden}.categories-field .selected-category .category{border-image:initial;border-radius:2px;background-color:#f8fffe;margin-left:0!important;border:1px solid #e6eced;box-shadow:0 1px 1px 0 rgba(0,0,0,.03);height:60px;overflow:hidden}.categories-field .selected-category .category .entry-ref-box{width:calc(100% - 71px);display:inline-block}.categories-field .selected-category .category.selected .entry-ref-box{padding:0 0 0 13px;position:relative;top:50%;transform:translateY(-50%)}.categories-field .selected-category .category .entry-ref-box .category-name{position:relative;padding-top:13px;padding-left:12px;padding-right:10px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.categories-field .selected-category .category.selected .entry-ref-box .category-name{position:static;padding-top:0;padding-left:0}.categories-field .selected-category .category.selected .entry-ref-box .refer-ct-name{font-size:12px;color:#a5abbb;margin-top:6px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.categories-field .selected-category .selected-category-action{float:right;position:relative;height:40px}.categories-field .selected-category .category.selected .selected-category-action{height:60px}.categories-field .selected-category .category.selected .entry-ref-box .refer-ct-name span{color:#748690}.categories-field .selected-category .action{padding:11px 10px 10px 13px;cursor:pointer;position:relative;height:38px;display:inline-block;width:45px;right:0;background-color:#f7f9fa}.categories-field .selected-category .category .action{width:50%;text-align:center;background:0 0}.categories-field .selected-category .category .action~.action{margin-left:-4px}.categories-field .selected-category .category.selected .selected-category-action .action{height:58px;padding-top:20px;margin:0}.categories-field .selected-category .edit-entry{border-left:1px solid #e6ecee;border-right:1px solid #e6ecee}.mb-3{height:210px}.btn{margin:10px 0 0 6px}@media (min-width:768px){.col-md-8{-ms-flex:0 0 70%;flex:0 0 70%;max-width:70%}}.col-md-8{width:70%;max-width:70%}</style>\n</head>\n\n<body>\n  <div id=\"loader\" class=\"reference-loading\">\n    <div class=\"loading-flash\">\n      <div></div>\n      <div></div>\n      <div></div>\n      <div></div>\n    </div>\n  </div>\n  <div id=\"message-container\" class=\"invalid\"></div>\n  <div class=\"main\">\n    <div class=\"selected-item\">\n      <div class=\"row selected-list\">\n      </div>\n    </div>\n    <button class=\"btn cs-btn-success choose_product\">Choose Products</button>\n  </div>\n  <script>const currencySymbols={USD:\"$\",EUR:\"€\",CRC:\"₡\",GBP:\"£\",ILS:\"₪\",INR:\"₹\",JPY:\"¥\",KRW:\"₩\",NGN:\"₦\",PHP:\"₱\",PLN:\"zł\",PYG:\"₲\",THB:\"฿\",UAH:\"₴\",VND:\"₫\"};function returnProductDetails(e){let o=e.id||\"\",r=e&&e.name&&e.name[commerceTools.locale]||\"\",c=e&&e.description?e.description[commerceTools.locale].replace(/(<([^>]+)>)/gi,\"\"):\"\",{sku:a,prices:n,images:l}=e&&e.masterVariant||\"\",{centAmount:t,currencyCode:m}=n&&n.length?n[0].value:\"\";return{id:o,name:r,description:c,images:l,price:`${currencySymbols[m]||\"\"}${currency(t/100)||\"Not Available\"}`,sku:a}}function returnCategoryDetail(e){let{id:o}=e||\"\";return{id:o,key:e&&e.key||\"\",name:e&&e.name&&e.name[commerceTools.locale]||\"\",slug:e&&e.slug&&e.slug[commerceTools.locale]||\"\",parentCategory:e&&e.parent&&e.parent.obj&&e.parent.obj.name?e.parent.obj.name[commerceTools.locale]:\"Not Available\"}}</script>\n  <script>function saveExtensionData(){let e=[];selectedItems.forEach(t=>e.push({id:t.id})),extensionField.field.setData(e)}</script>\n  <script>let childWindow,extensionField,accessToken,commerceTools,selectedItems=[];const row=$(\".selected-list\"),uidRegex=/[\\w]{8}-[\\w]{4}-[\\w]{4}-[\\w]{4}-[\\w]{12}/i;class Commercetools{constructor({api_url:e,auth_url:t,type:s,project_key:o,client_id:c,client_secret:n,locale:i,redirect_url:a}){this.projectKey=o,this.apiUrl=e,this.authUrl=t,this.type=s,this.clientId=c,this.clientSecret=n,this.locale=i,this.url=\"category\"!==s?`https://${this.apiUrl}/${this.projectKey}/product-projections`:`https://${this.apiUrl}/${this.projectKey}/categories`,this.redirectUrl=a}async auth(){let e={url:`https://${this.authUrl}/oauth/token?grant_type=client_credentials&scope=view_products:${this.projectKey}`,method:\"POST\",headers:{Accept:\"application/json\",\"Content-Type\":\"application/json;charset=UTF-8\",Authorization:`Basic ${btoa(this.clientId+\":\"+this.clientSecret)}`}};try{return(await axios(e)).data.access_token}catch(e){return $(\"#message-container\").text(e.response.data.message||\"Failed to retrieve access token. Check Config\"),$(\"#message-container\").show(),$(\"#loader\").hide(),\"\"}}async returnOption(e){return axios({url:`${this.url}/${e}?expand=parent.id`,method:\"GET\",headers:{Accept:\"application/json\",\"Content-Type\":\"application/json;charset=UTF-8\",authorization:`Bearer ${accessToken}`},data:{}})}async getSelectedProduct(e,t={}){let s=[];e.forEach(({id:e})=>s.push(this.returnOption(e)));try{return await axios.all(s)}catch(e){return e}}}function popupwindow({url:e,title:t,w:s,h:o}){var c=screen.width/2-s/2,n=screen.height/2-o/2;return window.open(e,t,`toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=${s}, height=${o}, top=${n}, left=${c}`)}function appendCategory(e){let{id:t,key:s,name:o}=returnCategoryDetail(e),{error:c}=e,n=`<div class=\"categories-field w-60\" id=${t}>\\n      <ul class=\"selected-category\">\\n        <li class=\"id\">\\n          <div class=\"category selected\">\\n            <div class=\"entry-ref-box\">\\n              <div class=\"category-name ${!c||\"error-text\"}\">${o?\"Category: <span>\"+o:c}</span></div>\\n              <div class=\"refer-ct-name\">${s?\"Key: <span>\"+s:\"\"}</span></div>\\n            </div>\\n            <div class=\"selected-category-action\">\\n              <span class=\"action\" onclick=\"remove('${t}')\">\\n                <img src=\"https://app.contentstack.com/static/images/remove-entry.svg\">\\n              </span>\\n              <span class=\"action edit-entry\">\\n                <a target=\"_blank\" href=\"https://mc.commercetools.co/${commerceTools.projectKey}/categories/${t}\">\\n                <img src=\"https://app.contentstack.com/static/images/edit-icon-ref1.svg\"></a>\\n              </span>\\n            </div>\\n          </div>\\n        </li>\\n      </ul>\\n      </div>`;selectedItems.push(e),row.append(n)}function updateCss(e){$(`#${e} .col-md-8`).css({\"max-width\":\"100%\",flex:\"0 0 100%\"})}function appendProduct(e){let{id:t,name:s,description:o,images:c,price:n}=returnProductDetails(e),{error:i}=e,a=`<div class=\"col-sm-6\" id=${t}>\\n      <div class=\"card mb-3 ${!i||\"error-bg\"}\">\\n        <div class=\"row no-gutters\">\\n        ${c&&c.length&&c[0].url?`<div class=\"col-md-4 img-container\">\\n            <img class=\" img-to-fit\" src='${c[0].url}' alt=\"${s}\">\\n       </div>`:\"\"}\\n          <div class=\"col-md-8\">\\n            <div class=\"card-body\">\\n              <div class=\"action\">\\n                <span class=\"edit\">\\n                  <a target=\"_blank\" href=\"https://mc.commercetools.co/${commerceTools.projectKey}/products/${t}\"><img src=\"https://app.contentstack.com/static/images/edit-icon-ref1.svg\"></a>\\n                </span>\\n                <span class=\"remove\" onclick=\"remove('${t}')\">\\n                  <img src=\"https://app.contentstack.com/static/images/remove-entry.svg\">\\n                </span>\\n              </div>\\n              <h5 class=\"card-title ${!i||\"error-text-product\"}\" title=\"${s}\">${s||i}</h5>\\n              <h6 class=\"card-subtitle\">${i?\"\":`Price: ${n}`}</h6>\\n              <p class=\"card-text\" title=\"${o}\"><small class=\"text-muted\">${o}</small></p>\\n            </div>\\n          </div>\\n        </div>\\n      </div>\\n    </div>`;selectedItems.push(e),row.append(a),i&&updateCss(t)}async function renderSelected(){let e=extensionField.field.getData()||[];if($(\".choose_product\").text(`Add ${\"category\"===commerceTools.type?\"Category\":\"Products\"}`),null!=e&&!$.isEmptyObject(e)&&e.length){let t=await commerceTools.getSelectedProduct(e);t&&t.forEach(({data:e})=>{\"category\"===commerceTools.type?appendCategory(e):appendProduct(e)})}$(\"#loader\").hide(),$(\".main\").show()}async function renderSelectedfrmPopup(e){row.empty(),selectedItems=[],\"category\"===commerceTools.type?e.forEach(e=>appendCategory(e)):e.forEach(e=>appendProduct(e)),saveExtensionData()}function handleMessage(e){\"openedReady\"===e.data?childWindow.postMessage({message:\"init\",config:extensionField.config,selectedItems:selectedItems,accessToken:accessToken},\"*\"):\"add\"===e.data.message?renderSelectedfrmPopup(e.data.selectedItems):\"close\"===e.data.message&&(childWindow=void 0)}function remove(e){selectedItems.splice(selectedItems.findIndex(t=>t.id===e),1),$(`#${e}`).remove(),saveExtensionData(),childWindow&&childWindow.postMessage({message:\"remove\",deletedId:e},\"*\")}axios.interceptors.request.use(e=>(e.timeout=1e4,e),e=>Promise.reject(e)),axios.interceptors.response.use(e=>e,e=>404===e.response.status?{data:{id:e.response.config.url.match(uidRegex)[0],error:`Failed to find ${commerceTools.type&&commerceTools.type.split(\"_\")[0]||\"product\"} with uid ${e.response.config.url.match(uidRegex)}`}}:Promise.reject(e)),$(\".choose_product\").click(()=>{childWindow?childWindow.focus():(childWindow=popupwindow({url:`${commerceTools.redirectUrl||\"redirect.html\"}`,title:\"Commercetools\",w:1600,h:800}),window.addEventListener(\"message\",handleMessage,!1))}),window.addEventListener(\"beforeunload\",e=>{childWindow&&childWindow.close(),childWindow=void 0}),$(document).ready(()=>{ContentstackUIExtension.init().then(async e=>{extensionField=e,Object.assign(e.config,e.fieldConfig),commerceTools=new Commercetools(e.config),(accessToken=await commerceTools.auth())&&(renderSelected(),extensionField.window.enableAutoResizing(),extensionField.window.updateHeight())})});</script>\n</body>\n</html>" } }
